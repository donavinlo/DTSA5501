---
title: "COVID_DATA"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Packages
We will only need the following packages when working this example. Please import
using 'library()'
* tidyverse
* lubridate

```{r _load_packages}
library(tidyverse)
library(lubridate)
```

## Loading Data
I will start by reading in the data from the four main csv files.

```{r get_jhu_data}
## Get current Data in the four files
#They all begin in the same way
url_in <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/"

filenames <- c("time_series_covid19_confirmed_global.csv", 
               "time_series_covid19_deaths_global.csv",
               "time_series_covid19_confirmed_US.csv", 
               "time_series_covid19_deaths_US.csv"
               )
urls <- str_c(url_in, filenames)
```

```{r import_data, message=FALSE}
global_cases <- read_csv(urls[1])
global_deaths <- read_csv(urls[2])
us_cases <- read_csv(urls[3])
us_deaths <- read_csv(urls[4])
```

## Now We're going to work on transforming and tidying the data

We'll start by combining the case and death per date into one variable called 'global';
we will do this by joining the cases with the deaths and the renaming our 'country region'
and 'Province State' to get rid of the slash. Also, need to notice that our date
was not a date object. We will need the *lubridate* package for this.

```{r tidy_join_global_data}
global <- global_cases %>%
  full_join(global_deaths) %>%
  rename(Country_Region = `Country/Region`,
         Province_State = `Province/State`) %>%
  mutate(date = mdy(date))
```

Look at the data and see if there's any problems. We think there are a lot of 
rows with 0. So we also want to filter those out.

```{r tidy_global_data_summary}
global <- global %>% filter(cases > 0)
summary(global)
```

Looking at the summary table, there are a few concerns. First we want to see if
the maximum number of cases should really be that large. We can see the data is
valid because there are numerous cases with this amount of data.

```{r tidy_global_filter_maax}
global %>% filter(cases > 28000000)
```

Now we want to take a look at the US cases. When looking at the dataset we can
see some weird codes/data types. We want to pivot the dates, keep Admin2, Province/State,
Country/Region and Lat/Long.. Select all the important variables. Make date a date object.
Select all the remaining columns except Latitude and Longitude.

```{r tidy_us_cases_data}
us_cases <- us_cases %>%
  pivot_longer(cols = -(UID:Combined_Key), #got rif of 
               names_to = "date",
               values_to = "cases") %>%
  select(Admin2:cases) %>%
  mutate(date = mdy(date)) %>%
  select(-c(Lat, Long_))
```

We want to do the same for us_deaths. We can't always assume the two data sets
will be in similar formats. But we are for this situation.
```{r tidy_us_deaths_data}
us_deaths <- us_deaths %>%
  pivot_longer(cols = -(UID:Population), #got rif of 
               names_to = "date",
               values_to = "deaths") %>%
  select(Admin2:deaths) %>%
  mutate(date = mdy(date)) %>%
  select(-c(Lat, Long_))
```

We will join the two different US datasets
```{r tidy_us_join_data}
US <- us_cases %>%
full_join(us_deaths)
```

We want to combine the state and country_region of global dataset
```{r tidy_global_country_region_data}
global <- global %>%
  unite("Combined_Key",
        c(Province_State, Country_Region),
        sep = ", ",
        na.rm = TRUE,
        remove = FALSE)
```

Importing csv to grab population variable
``` {r tidy_population_csv_load}
uid_lookup_url <- "https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/UID_ISO_FIPS_LookUp_Table.csv"

uid <- read_csv(uid_lookup_url) %>%
  select(-c(Lat, Long_, Combined_Key, code3, iso2, iso3, Admin2))
```

Adding uid csv to global dataset to add the population as a column
```{r tidy_global_add_pop}
global <- global %>%
  left_join(uid, by = c("Province_State", "Country_Region")) %>%
  select(-c(UID, FIPS)) %>%
  select(Province_State, Country_Region, date, cases, deaths, Population, Combined_Key)
```